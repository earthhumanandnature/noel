<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Quả Cầu Tuyết Giáng Sinh 3D</title>
  <style>
    body { margin:0; overflow:hidden; background:#000; }
    .info {
      position: absolute; top: 15px; left: 15px; color: #fff; background: rgba(0,0,0,0.6);
      padding: 15px 20px; border-radius: 12px; font-size: 16px; pointer-events: none; z-index: 10;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>

<div class="info">
  Giữ chuột trái + kéo để xoay quả cầu<br>
  <strong>Chúc bạn một Giáng Sinh thật vui vẻ!</strong>
</div>

<!-- DÙNG UNPKG - ĐƯỜNG DẪN CŨ HOÀN TOÀN KHÔNG CẦN MODULE -->
<script src="https://unpkg.com/three@0.168.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.168.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://unpkg.com/three@0.168.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
// ============== TẤT CẢ CODE Ở ĐÂY - KHÔNG DÙNG IMPORT, KHÔNG DÙNG MODULE ==============
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0b1526);
scene.fog = new THREE.FogExp2(0x0b1526, 0.0015);

const camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 1000);
camera.position.set(0, 9, 25);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

// Controls
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.08;
controls.enablePan = false;
controls.minDistance = 18;
controls.maxDistance = 50;

// Ánh sáng
scene.add(new THREE.AmbientLight(0xffffff, 0.7));
const dirLight = new THREE.DirectionalLight(0xffffff, 1.4);
dirLight.position.set(15, 30, 15);
scene.add(dirLight);
scene.add(new THREE.HemisphereLight(0xb3e5fc, 0x3d2b5e, 0.8));

const globeGroup = new THREE.Group();
scene.add(globeGroup);

// === NỀN TUYẾT ===
const ground = new THREE.Mesh(
  new THREE.CircleGeometry(120, 64),
  new THREE.MeshStandardMaterial({ color: 0xf5f8ff, roughness: 0.9 })
);
ground.rotation.x = -Math.PI / 2;
ground.position.y = -0.1;
scene.add(ground);

// === QUẢ CẦU PHA LÊ ===
const glass = new THREE.Mesh(
  new THREE.SphereGeometry(8, 64, 64),
  new THREE.MeshPhysicalMaterial({
    color: 0xffffff,
    metalness: 0,
    roughness: 0,
    transmission: 0.98,
    thickness: 2,
    clearcoat: 1,
    clearcoatRoughness: 0,
    ior: 1.5
  })
);
globeGroup.add(glass);

// === GIÁ ĐỠ VÀNG ===
const goldMat = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.95, roughness: 0.15 });
const base = new THREE.Mesh(new THREE.CylinderGeometry(9.5, 10.5, 2, 64), goldMat);
base.position.y = -9.5;
globeGroup.add(base);
const stand = new THREE.Mesh(new THREE.CylinderGeometry(4.5, 5.5, 4, 64), goldMat);
stand.position.y = -12;
globeGroup.add(stand);

// === CÂY THÔNG NOEL THẬT (GLTF) ===
let tree;
new THREE.GLTFLoader().load(
  'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/gltf/ChristmasTree/ChristmasTree.gltf',
  gltf => {
    tree = gltf.scene;
    tree.scale.set(3.5, 3.5, 3.5);
    tree.position.y = -6;
    globeGroup.add(tree);
  }
);

// === HỘP QUÀ ===
for(let i = 0; i < 12; i++){
  const angle = i/12 * Math.PI * 2;
  const r = 2 + Math.random() * 3;
  const gift = new THREE.Group();
  const box = new THREE.Mesh(
    new THREE.BoxGeometry(1.5,1.5,1.5),
    new THREE.MeshStandardMaterial({ color: Math.random()>0.5 ? 0xff0033 : 0x00aa00 })
  );
  gift.add(box);
  const ribbon = new THREE.Mesh(new THREE.BoxGeometry(1.7,0.2,0.2), new THREE.MeshStandardMaterial({color:0xffff33}));
  ribbon.position.y = 0.75;
  gift.add(ribbon);
  gift.add(ribbon.clone().rotateY(Math.PI/2));
  gift.position.set(Math.cos(angle)*r, -7.2, Math.sin(angle)*r);
  gift.rotation.y = Math.random() * Math.PI;
  globeGroup.add(gift);
}

// === TUYẾT RƠI TRONG QUẢ CẦU ===
const snowflakes = [];
for(let i = 0; i < 500; i++){
  const s = new THREE.Mesh(
    new THREE.SphereGeometry(0.08, 6, 6),
    new THREE.MeshBasicMaterial({ color: 0xffffff })
  );
  s.position.set(
    (Math.random()-0.5)*14,
    Math.random()*20 - 4,
    (Math.random()-0.5)*14
  );
  globeGroup.add(s);
  snowflakes.push(s);
}

// === TUYẾT RƠI NGOÀI TRỜI ===
const outsideSnow = [];
for(let i = 0; i < 400; i++){
  const s = new THREE.Mesh(
    new THREE.SphereGeometry(0.08, 6, 6),
    new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.8 })
  );
  s.position.set(
    (Math.random()-0.5)*300,
    Math.random()*80 + 10,
    (Math.random()-0.5)*300
  );
  scene.add(s);
  outsideSnow.push(s);
}

// === ANIMATION ===
function animate() {
  requestAnimationFrame(animate);
  controls.update();

  // Tuyết trong quả cầu
  snowflakes.forEach(s => {
    s.position.y -= 0.03 + Math.random()*0.03;
    s.position.x += Math.sin(Date.now()*0.001 + s.position.z)*0.02;
    if(s.position.y < -15){
      s.position.y = 12;
      s.position.x = (Math.random()-0.5)*14;
      s.position.z = (Math.random()-0.5)*14;
    }
  });

  // Tuyết ngoài trời
  outsideSnow.forEach(s => {
    s.position.y -= 0.04;
    if(s.position.y < -5) s.position.y = 80;
  });

  // Xoay cây thông nhẹ
  if(tree) tree.rotation.y += 0.004;

  renderer.render(scene, camera);
}
animate();

// Resize
window.addEventListener('resize', () => {
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>

</body>
</html>
