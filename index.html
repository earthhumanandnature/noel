<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Quả Cầu Tuyết Giáng Sinh 3D - Chúc Mừng Noel!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; overflow:hidden; background:#000; font-family: 'Segoe UI', sans-serif; }
    canvas { display:block; }
    .info {
      position: absolute; top: 15px; left: 15px; color: #fff; background: rgba(0,0,0,0.6);
      padding: 12px 18px; border-radius: 12px; font-size: 15px; pointer-events: none; z-index: 100;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>

<div class="info">
  Giữ chuột trái + kéo để xoay quả cầu<br>
  <strong>Chúc bạn Giáng Sinh an lành & ấm áp!</strong>
</div>

<!-- Three.js + controls + loader (phiên bản cũ - chạy trực tiếp) -->
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
// ============== CẤU HÌNH CƠ BẢN ==============
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0d1b2a);
scene.fog = new THREE.FogExp2(0x0d1b2a, 0.0018);

const camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 1000);
camera.position.set(0, 8, 22);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
renderer.outputEncoding = THREE.sRGBEncoding;
document.body.appendChild(renderer.domElement);

// Controls - kéo chuột trái để xoay
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.07;
controls.rotateSpeed = 0.6;
controls.enablePan = false;
controls.minDistance = 15;
controls.maxDistance = 45;
controls.maxPolarAngle = Math.PI / 2 + 0.2;

// Ánh sáng
scene.add(new THREE.AmbientLight(0xffffff, 0.6));
const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
dirLight.position.set(15, 25, 10);
scene.add(dirLight);
scene.add(new THREE.HemisphereLight(0x87CEEB, 0x3b1e40, 0.9));

// Nhóm chứa toàn bộ quả cầu (để xoay chung)
const globeGroup = new THREE.Group();
scene.add(globeGroup);

// ============== NỀN TUYẾT + NHÀ + CÂY THÔNG NGOÀI TRỜI ==============
// Mặt đất tuyết
const ground = new THREE.Mesh(
  new THREE.CircleGeometry(100, 64),
  new THREE.MeshStandardMaterial({ color: 0xf8f9ff, roughness: 0.95 })
);
ground.rotation.x = -Math.PI / 2;
ground.position.y = -0.05;
scene.add(ground);

// Nhà phủ tuyết
function createHouse(x, z) {
  const house = new THREE.Group();
  const body = new THREE.Mesh(new THREE.BoxGeometry(5, 5, 5), new THREE.MeshStandardMaterial({ color: 0xd32f2f }));
  body.position.y = 2.5;
  house.add(body);

  const roof = new THREE.Mesh(new THREE.ConeGeometry(6, 3.5, 4), new THREE.MeshStandardMaterial({ color: 0xffffff }));
  roof.position.y = 7;
  roof.rotation.y = Math.PI / 4;
  house.add(roof);

  house.position.set(x, 0, z);
  house.scale.set(0.9, 0.9, 0.9);
  scene.add(house);
}
createHouse(-18, -22);
createHouse(20, -15);
createHouse(-15, 12);

// Cây thông lớn phủ tuyết
function createBigTree(x, z) {
  const tree = new THREE.Group();
  const trunk = new THREE.Mesh(new THREE.CylinderGeometry(1, 1.3, 5), new THREE.MeshStandardMaterial({ color: 0x8B4513 }));
  trunk.position.y = 2.5;
  tree.add(trunk);

  [4.5, 3.5, 2.5].forEach((size, i) => {
    const cone = new THREE.Mesh(new THREE.ConeGeometry(size, 6, 12), new THREE.MeshStandardMaterial({ color: 0x0d6623 }));
    cone.position.y = 6 + i * 5;
    tree.add(cone);

    const snow = new THREE.Mesh(new THREE.ConeGeometry(size * 0.85, 1, 12), new THREE.MeshStandardMaterial({ color: 0xffffff }));
    snow.position.y = cone.position.y + 3;
    tree.add(snow);
  });
  tree.position.set(x, 0, z);
  scene.add(tree);
}
createBigTree(28, -12);
createBigTree(-25, -20);

// ============== QUẢ CẦU PHA LÊ ==============
const glassSphere = new THREE.Mesh(
  new THREE.SphereGeometry(8, 64, 64),
  new THREE.MeshPhysicalMaterial({
    color: 0xffffff,
    metalness: 0,
    roughness: 0,
    transmission: 0.98,
    thickness: 1.8,
    clearcoat: 1,
    clearcoatRoughness: 0,
    ior: 1.5,
    envMapIntensity: 2
  })
);
globeGroup.add(glassSphere);

// Giá đỡ vàng + chân đế
const goldMaterial = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.95, roughness: 0.15 });

const base = new THREE.Mesh(new THREE.CylinderGeometry(9.2, 10, 2, 64), goldMaterial);
base.position.y = -9.5;
globeGroup.add(base);

const stand = new THREE.Mesh(new THREE.CylinderGeometry(4.5, 5.5, 4, 64), goldMaterial);
stand.position.y = -12;
globeGroup.add(stand);

// ============== BÊN TRONG QUẢ CẦU ==============
// Cây thông Noel thật có đèn màu (GLTF)
let christmasTree;
new THREE.GLTFLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/gltf/ChristmasTree/ChristmasTree.gltf', (gltf) => {
  christmasTree = gltf.scene;
  christmasTree.scale.set(3.2, 3.2, 3.2);
  christmasTree.position.y = -6;
  globeGroup.add(christmasTree);
});

// Hộp quà
function createGift(x, z) {
  const gift = new THREE.Group();
  const box = new THREE.Mesh(
    new THREE.BoxGeometry(1.6, 1.6, 1.6),
    new THREE.MeshStandardMaterial({ color: Math.random() > 0.5 ? 0xff0033 : 0x00aa33 })
  );
  gift.add(box);

  const ribbon = new THREE.Mesh(new THREE.BoxGeometry(1.8, 0.25, 0.25), new THREE.MeshStandardMaterial({ color: 0xffff66 }));
  ribbon.position.y = 0.8;
  gift.add(ribbon);
  const ribbon2 = ribbon.clone();
  ribbon2.rotation.y = Math.PI / 2;
  gift.add(ribbon2);

  gift.position.set(x, -7.1, z);
  gift.rotation.y = Math.random() * Math.PI;
  globeGroup.add(gift);
}
for (let i = 0; i < 10; i++) {
  const angle = i / 10 * Math.PI * 2;
  const r = 2.5 + Math.random() * 2.5;
  createGift(Math.cos(angle) * r, Math.sin(angle) * r);
}

// ============== TUYẾT RƠI BÊN TRONG + NGOÀI TRỜI ==============
const snowflakes = [];
const snowGeo = new THREE.SphereGeometry(0.09, 8, 8);
const snowMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.9 });

for (let i = 0; i < 450; i++) {
  const s = new THREE.Mesh(snowGeo, snowMat);
  s.position.set(
    (Math.random() - 0.5) * 15,
    Math.random() * 25 - 5,
    (Math.random() - 0.5) * 15
  );
  globeGroup.add(s);
  snowflakes.push(s);
}

// Tuyết rơi ngoài trời
const outsideSnow = [];
for (let i = 0; i < 350; i++) {
  const s = new THREE.Mesh(snowGeo, snowMat);
  s.position.set(
    (Math.random() - 0.5) * 250,
    Math.random() * 60 + 10,
    (Math.random() - 0.5) * 250
  );
  scene.add(s);
  outsideSnow.push(s);
}

// ============== ANIMATION ==============
function animateSnow() {
  snowflakes.forEach(s => {
    s.position.y -= 0.02 + Math.random() * 0.04;
    s.position.x += Math.sin(Date.now() * 0.0008 + s.position.z) * 0.015;
    if (s.position.y < -15) {
      s.position.y = 12;
      s.position.x = (Math.random() - 0.5) * 14;
      s.position.z = (Math.random() - 0.5) * 14;
    }
  });
}

function animateOutsideSnow() {
  outsideSnow.forEach(s => {
    s.position.y -= 0.035;
    if (s.position.y < -5) s.position.y = 60;
  });
}

// Resize
window.addEventListener('resize', () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});

// Loop chính
function animate() {
  requestAnimationFrame(animate);
  controls.update();
  animateSnow();
  animateOutsideSnow();

  if (christmasTree) christmasTree.rotation.y += 0.003;

  renderer.render(scene, camera);
}
animate();

</script>
</body>
</html>
